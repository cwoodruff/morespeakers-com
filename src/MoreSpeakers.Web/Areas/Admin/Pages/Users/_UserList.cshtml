@model MoreSpeakers.Web.Areas.Admin.Pages.Users.IndexModel
@{
    var q = Model.Query;
    int totalPages = (int)Math.Ceiling((double)Model.Result.TotalCount / Math.Max(1, Model.Result.PageSize));
    totalPages = Math.Max(1, totalPages);

    string SortDirFor(string col)
    {
        var isSame = string.Equals(q.Sort, col, StringComparison.OrdinalIgnoreCase);
        var dir = isSame && string.Equals(q.Dir, "asc", StringComparison.OrdinalIgnoreCase) ? "desc" : "asc";
        return dir;
    }

    string CaretFor(string col)
    {
        var isActive = string.Equals(q.Sort, col, StringComparison.OrdinalIgnoreCase);
        if (!isActive) return "";
        var asc = string.Equals(q.Dir, "asc", StringComparison.OrdinalIgnoreCase);
        return asc ? "<i class=\"bi bi-caret-up-fill ms-1\"></i>" : "<i class=\"bi bi-caret-down-fill ms-1\"></i>";
    }
}

<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>
          <a hx-get hx-target="#user-list-container" hx-push-url="true"
             asp-page="/Users/Index" asp-route-q="@q.Q" asp-route-lockout="@q.Lockout" asp-route-emailConfirmed="@q.EmailConfirmed" asp-route-role="@q.Role" asp-route-pageSize="@q.PageSize" asp-route-sort="email" asp-route-dir="@SortDirFor("email")">Email</a>
          @Html.Raw(CaretFor("email"))
        </th>
        <th>
          <a hx-get hx-target="#user-list-container" hx-push-url="true"
             asp-page="/Users/Index" asp-route-q="@q.Q" asp-route-lockout="@q.Lockout" asp-route-emailConfirmed="@q.EmailConfirmed" asp-route-role="@q.Role" asp-route-pageSize="@q.PageSize" asp-route-sort="username" asp-route-dir="@SortDirFor("username")">Username</a>
          @Html.Raw(CaretFor("username"))
        </th>
        <th class="text-center">
          <a hx-get hx-target="#user-list-container" hx-push-url="true"
             asp-page="/Users/Index" asp-route-q="@q.Q" asp-route-lockout="@q.Lockout" asp-route-emailConfirmed="@q.EmailConfirmed" asp-route-role="@q.Role" asp-route-pageSize="@q.PageSize" asp-route-sort="emailconfirmed" asp-route-dir="@SortDirFor("emailconfirmed")">Email Confirmed</a>
          @Html.Raw(CaretFor("emailconfirmed"))
        </th>
        <th class="text-center">
          <a hx-get hx-target="#user-list-container" hx-push-url="true"
             asp-page="/Users/Index" asp-route-q="@q.Q" asp-route-lockout="@q.Lockout" asp-route-emailConfirmed="@q.EmailConfirmed" asp-route-role="@q.Role" asp-route-pageSize="@q.PageSize" asp-route-sort="lockout" asp-route-dir="@SortDirFor("lockout")">Lockout</a>
          @Html.Raw(CaretFor("lockout"))
        </th>
        <th>
          <a hx-get hx-target="#user-list-container" hx-push-url="true"
             asp-page="/Users/Index" asp-route-q="@q.Q" asp-route-lockout="@q.Lockout" asp-route-emailConfirmed="@q.EmailConfirmed" asp-route-role="@q.Role" asp-route-pageSize="@q.PageSize" asp-route-sort="role" asp-route-dir="@SortDirFor("role")">Role</a>
          @Html.Raw(CaretFor("role"))
        </th>
        <th>
          <a hx-get hx-target="#user-list-container" hx-push-url="true"
             asp-page="/Users/Index" asp-route-q="@q.Q" asp-route-lockout="@q.Lockout" asp-route-emailConfirmed="@q.EmailConfirmed" asp-route-role="@q.Role" asp-route-pageSize="@q.PageSize" asp-route-sort="created" asp-route-dir="@SortDirFor("created")">Created</a>
          @Html.Raw(CaretFor("created"))
        </th>
      </tr>
    </thead>
    <tbody>
    @if (!Model.Result.Items.Any())
    {
      <tr>
        <td colspan="6" class="text-muted">No users found.</td>
      </tr>
    }
    else
    {
      foreach (var user in Model.Result.Items)
      {
        <tr>
          <td>
            <a asp-area="Admin" asp-page="/Users/Details" asp-route-id="@user.Id">@user.Email</a>
          </td>
          <td>@user.UserName</td>
          <td class="text-center">
            @if (user.EmailConfirmed) { <i class="bi bi-check-circle text-success" aria-label="Email confirmed"></i> }
            else { <i class="bi bi-x-circle text-secondary" aria-label="Email not confirmed"></i> }
          </td>
          <td class="text-center">
            @if (user.IsLockedOut) { <i class="bi bi-lock text-danger" aria-label="Locked out"></i> } else { <i class="bi bi-unlock text-secondary" aria-label="Not locked out"></i> }
          </td>
          <td>@user.Role</td>
          <td>@(user.CreatedUtc?.ToString("yyyy-MM-dd"))</td>
        </tr>
      }
    }
    </tbody>
  </table>
</div>

<nav aria-label="Users pagination">
  <ul class="pagination justify-content-end">
    <li class="page-item @(Model.Result.Page <= 1 ? "disabled" : null)">
      <a class="page-link" hx-get hx-target="#user-list-container" hx-push-url="true"
         asp-page="/Users/Index" asp-route-q="@q.Q" asp-route-lockout="@q.Lockout" asp-route-emailConfirmed="@q.EmailConfirmed" asp-route-role="@q.Role" asp-route-sort="@q.Sort" asp-route-dir="@q.Dir" asp-route-pageSize="@q.PageSize" asp-route-page="@(Model.Result.Page - 1)" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
    @for (var p = 1; p <= totalPages; p++)
    {
      <li class="page-item @(p == Model.Result.Page ? "active" : null)">
        <a class="page-link" hx-get hx-target="#user-list-container" hx-push-url="true"
           asp-page="/Users/Index" asp-route-q="@q.Q" asp-route-lockout="@q.Lockout" asp-route-emailConfirmed="@q.EmailConfirmed" asp-route-role="@q.Role" asp-route-sort="@q.Sort" asp-route-dir="@q.Dir" asp-route-pageSize="@q.PageSize" asp-route-page="@p">@p</a>
      </li>
    }
    <li class="page-item @(Model.Result.Page >= totalPages ? "disabled" : null)">
      <a class="page-link" hx-get hx-target="#user-list-container" hx-push-url="true"
         asp-page="/Users/Index" asp-route-q="@q.Q" asp-route-lockout="@q.Lockout" asp-route-emailConfirmed="@q.EmailConfirmed" asp-route-role="@q.Role" asp-route-sort="@q.Sort" asp-route-dir="@q.Dir" asp-route-pageSize="@q.PageSize" asp-route-page="@(Model.Result.Page + 1)" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
  @if (totalPages > 1)
  {
    <div class="text-muted small text-end">Page @Model.Result.Page of @totalPages</div>
  }
</nav>
