@using MoreSpeakers.Web.Models
@model MoreSpeakers.Web.Areas.Identity.Pages.Account.RegisterModel
@{
    var currentStep = Model.CurrentStep;
    var hasValidationErrors = Model.HasValidationErrors;
    var successMessage = Model.SuccessMessage;
    var validationMessage = Model.ValidationMessage;
}

<form id="registerForm" method="post">
    <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

    @if (hasValidationErrors && !string.IsNullOrEmpty(validationMessage))
    {
        <div class="alert alert-danger mb-3">
            <i class="bi bi-exclamation-triangle me-2"></i>@validationMessage
        </div>
    }
    @if (!hasValidationErrors && !string.IsNullOrEmpty(successMessage))
    {
        <div class="alert alert-success mb-3">
            <i class="bi bi-check-circle me-2"></i>@successMessage
        </div>
    }

    <!-- Progress Indicator -->
    <div class="mb-4">
        <div class="row text-center" id="stepIndicator">
            @for (int i = 1; i <= RegistrationProgressions.Complete; i++)
            {
                <div class="col">
                    @if (i == RegistrationProgressions.Complete && currentStep == RegistrationProgressions.Complete)
                    {
                        <i class="bi bi-@i-circle-fill text-success" data-step="@i" style="font-size:2rem;"></i>    
                    }
                    else
                    {
                        <i class="bi bi-@i-circle@(i < currentStep ? "-fill text-success" : i == currentStep ? "-fill text-primary" : " text-secondary")" data-step="@i" style="font-size:2rem;"></i>    
                    }
                    <p class="text-sm mb-0">
                        @(i switch { RegistrationProgressions.SpeakerProfileNeeded => "Account", RegistrationProgressions.RequiredInformationNeeded => "Profile", RegistrationProgressions.ExpertiseNeeded => "Expertise", RegistrationProgressions.SocialMediaNeeded => "Social", RegistrationProgressions.Complete => "Complete", _ => "" })
                    </p>
                </div>
            }
        </div>
    </div>

    <!-- Step Container -->
    <div id="stepContainer">
        @switch (currentStep)
        {
            case RegistrationProgressions.SpeakerProfileNeeded:
                <partial name="_RegisterStep1" model="Model"/>
                break;
            case RegistrationProgressions.RequiredInformationNeeded:
                <partial name="_RegisterStep2" model="Model"/>
                break;
            case RegistrationProgressions.ExpertiseNeeded:
                <partial name="_RegisterStep3" model="Model"/>
                break;
            case RegistrationProgressions.SocialMediaNeeded:
                <partial name="_RegisterStep4" model="Model"/>
                break;
            case RegistrationProgressions.Complete:
                <partial name="_RegisterStep5" model="Model"/>
                break;
        }
    </div>

    <!-- Navigation Buttons -->
    @if (currentStep < RegistrationProgressions.Complete)
    {
        <div class="d-flex justify-content-between mt-4" id="navigationButtons">
            <button type="button" id="prevBtn" 
                    class="btn btn-outline-secondary @(currentStep == RegistrationProgressions.SpeakerProfileNeeded ? "invisible": "visible")"
                    hx-post="/Register?handler=PreviousStep"
                    hx-target="#registrationContainer"
                    hx-include="#registerForm"
                    hx-vals='{"step": "@currentStep"}'
                    hx-swap="innerHTML">
                <i class="bi bi-arrow-left me-2"></i>Previous
            </button>
            @if (currentStep < RegistrationProgressions.SocialMediaNeeded)
            {
                <button type="button" id="nextBtn" class="btn btn-primary"
                        hx-post="/Register?handler=ValidateStep"
                        hx-target="#registrationContainer"
                        hx-include="#registerForm"
                        hx-vals='{"step": "@currentStep"}'
                        hx-swap="innerHTML">
                    Next<i class="bi bi-arrow-right ms-2"></i>
                </button>
            }
            else
            {
                <button type="button" id="submitBtn" class="btn btn-success"
                        hx-post="/Register?handler=Submit"
                        hx-target="#registrationContainer"
                        hx-include="#registerForm"
                        hx-swap="innerHTML">
                    <i class="bi bi-person-plus me-2"></i>Create Account
                </button>
            }
        </div>
    }
</form>