@model MoreSpeakers.Web.Areas.Identity.Pages.Account.RegisterModel
@{
    var currentStep = Model.CurrentStep;
    var hasValidationErrors = Model.HasValidationErrors;
    var successMessage = Model.SuccessMessage;
    var validationMessage = Model.ValidationMessage;
}

<form id="registerForm" asp-route-returnUrl="@Model.ReturnUrl" method="post">
    <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

    @if (hasValidationErrors && !string.IsNullOrEmpty(validationMessage))
    {
        <div class="alert alert-danger mb-3">
            <i class="bi bi-exclamation-triangle me-2"></i>@validationMessage
        </div>
    }
    @if (!hasValidationErrors && !string.IsNullOrEmpty(successMessage))
    {
        <div class="alert alert-success mb-3">
            <i class="bi bi-check-circle me-2"></i>@successMessage
        </div>
    }

    <!-- Progress Indicator -->
    <div class="mb-4">
        <div class="row text-center" id="stepIndicator">
            @for (int i = 1; i <= 5; i++)
            {
                <div class="col">
                    <i class="bi bi-@i-circle@(i < currentStep ? "-fill text-success" : i == currentStep ? "-fill text-primary" : " text-secondary")" data-step="@i" style="font-size:2rem;"></i>
                    <p class="text-sm mb-0">
                        @(i switch { 1 => "Account", 2 => "Profile", 3 => "Expertise", 4 => "Social", 5 => "Complete", _ => "" })
                    </p>
                </div>
            }
        </div>
    </div>

    <!-- Step Container -->
    <div id="stepContainer">
        @switch (currentStep)
        {
            case 1:
                <partial name="_RegisterStep1" model="Model"/>
                break;
            case 2:
                <partial name="_RegisterStep2" model="Model"/>
                break;
            case 3:
                <partial name="_RegisterStep3" model="Model"/>
                break;
            case 4:
                <partial name="_RegisterStep4" model="Model"/>
                break;
            case 5:
                <partial name="_RegisterStep5" model="Model"/>
                break;
        }
    </div>

    <!-- Navigation Buttons -->
    @if (currentStep < 5)
    {
        <div class="d-flex justify-content-between mt-4" id="navigationButtons">
            <button type="button" id="prevBtn" class="btn btn-outline-secondary"
                    style="display: @(currentStep == 1 ? "none" : "block");"
                    hx-post="/Identity/Account/Register?handler=PreviousStep"
                    hx-target="#registrationContainer"
                    hx-include="#registerForm"
                    hx-vals='{"step": "@currentStep"}'
                    hx-swap="innerHTML">
                <i class="bi bi-arrow-left me-2"></i>Previous
            </button>

            @if (currentStep < 4)
            {
                <button type="button" id="nextBtn" class="btn btn-primary"
                        hx-post="/Identity/Account/Register?handler=ValidateStep"
                        hx-target="#registrationContainer"
                        hx-include="#registerForm"
                        hx-vals='{"step": "@currentStep"}'
                        hx-swap="innerHTML">
                    Next<i class="bi bi-arrow-right ms-2"></i>
                </button>
            }
            else
            {
                <button type="button" id="submitBtn" class="btn btn-success"
                        hx-post="/Identity/Account/Register?handler=Submit"
                        hx-target="#registrationContainer"
                        hx-include="#registerForm"
                        hx-swap="innerHTML">
                    <i class="bi bi-person-plus me-2"></i>Create Account
                </button>
            }
        </div>
    }
</form>

@if (currentStep == 5)
{
    <script>
        if (typeof MoreSpeakers !== 'undefined' && MoreSpeakers.updatePageHeader) {
            MoreSpeakers.updatePageHeader(5);
        }
    </script>
}
else
{
    <script>
        if (typeof MoreSpeakers !== 'undefined' && MoreSpeakers.updatePageHeader) {
            MoreSpeakers.updatePageHeader(@currentStep);
        }
    </script>
}