@model MoreSpeakers.Web.Models.ViewModels.SpeakerResultsViewModel

@if (!Model.Speakers.Any())
{
    @await Html.PartialAsync("~/Pages/Speakers/_SpeakerResults_NoResults.cshtml")
}
else
{
    <div class="row">
        @switch (Model.ViewType)
        {
            case SpeakerResultsViewType.CardView:
                @await Html.PartialAsync("~/Pages/Speakers/_SpeakerResults_CardView.cshtml", new SpeakerResultsSpeakersViewModel
                {
                    Speakers = Model.Speakers,
                    CurrentUser = Model.CurrentUser
                })
                break;
            case SpeakerResultsViewType.ListView:
                @await Html.PartialAsync("~/Pages/Speakers/_SpeakerResults_ListView.cshtml", new SpeakerResultsSpeakersViewModel
                {
                    Speakers = Model.Speakers,
                    CurrentUser = Model.CurrentUser
                })
                break;
        }
    </div>

    <!-- Pagination -->
    @if (Model.TotalPages > 1)
    {
        <nav aria-label="Speakers pagination" class="mt-4">
            <ul class="pagination justify-content-center">
                @if (Model.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link"
                           href="@GetPageUrl(Model.CurrentPage - 1)"
                           hx-get="@GetPageUrl(Model.CurrentPage - 1)"
                           hx-target="#speakers-container" hx-swap="morph">
                            <i class="bi bi-chevron-left"></i> Previous
                        </a>
                    </li>
                }
                @for (var pageNumber = 1; pageNumber <= Model.TotalPages; pageNumber++)
                {
                    <li class="page-item @(pageNumber == Model.CurrentPage ? "active" : "")">
                        <a class="page-link"
                           href="@GetPageUrl(pageNumber)"
                           hx-get="@GetPageUrl(pageNumber)"
                           hx-target="#speakers-container" hx-swap="morph">
                            @pageNumber
                        </a>
                    </li>
                }
                @if (Model.CurrentPage < Model.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link"
                           href="@GetPageUrl(Model.CurrentPage + 1)"
                           hx-get="@GetPageUrl(Model.CurrentPage + 1)"
                           hx-target="#speakers-container" hx-swap="morph">
                            Next <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                }
            </ul>
        </nav>
    }
}

@functions {

    private string GetPageUrl(int page)
    {
        var queryParams = new List<string>
        {
            $"CurrentPage={page}",
            $"ViewType={Model.ViewType}",
            $"SortBy={Model.SortBy}"
        };

        if (!string.IsNullOrEmpty(Model.SearchTerm))
            queryParams.Add($"SearchTerm={Uri.EscapeDataString(Model.SearchTerm)}");

        if (Model.SpeakerTypeFilter.HasValue)
            queryParams.Add($"SpeakerTypeFilter={Model.SpeakerTypeFilter}");

        if (Model.ExpertiseFilter != null && Model.ExpertiseFilter.Any())
        {
            foreach(var expertiseId in Model.ExpertiseFilter)
            {
                queryParams.Add($"ExpertiseFilter={expertiseId}");
            }
        }

        return $"/Speakers/Index?{string.Join("&", queryParams)}";
    }
}
