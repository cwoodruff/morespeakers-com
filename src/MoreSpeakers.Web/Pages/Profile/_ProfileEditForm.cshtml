@using MoreSpeakers.Domain.Extensions
@model EditModel

@if (Model.HasValidationErrors && !string.IsNullOrEmpty(Model.ValidationMessage))
{
    <div class="alert alert-danger mb-3">
        <i class="bi bi-exclamation-triangle me-2"></i>@Model.ValidationMessage
    </div>
}
@if (!Model.HasValidationErrors && !string.IsNullOrEmpty(Model.SuccessMessage))
{
    <div class="alert alert-success mb-3">
        <i class="bi bi-check-circle me-2"></i>@Model.SuccessMessage
    </div>
}

<form hx-post="/Profile/Edit?handler=UpdateProfile" 
      hx-target="#tabContent" 
      hx-swap="innerHTML" 
      hx-indicator="#loadingSpinner">
      
    <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

    <!-- Basic Information -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="border-bottom pb-2 mb-3">
                <i class="bi bi-person-badge me-2"></i>Basic Information
            </h5>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label asp-for="Input.FirstName" class="form-label fw-medium">First Name</label>
                <div class="input-group">
                    <span class="input-group-text border-end-0">
                        <i class="bi bi-person text-muted"></i>
                    </span>
                    <input asp-for="Input.FirstName" class="form-control border-start-0"
                           placeholder="Enter your first name"/>
                </div>
                <span asp-validation-for="Input.FirstName" class="text-danger small"></span>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="Input.LastName" class="form-label fw-medium">Last Name</label>
                <div class="input-group">
                    <span class="input-group-text border-end-0">
                        <i class="bi bi-person text-muted"></i>
                    </span>
                    <input asp-for="Input.LastName" class="form-control border-start-0" placeholder="Enter your last name"/>
                </div>
                <span asp-validation-for="Input.LastName" class="text-danger small"></span>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <label asp-for="Input.PhoneNumber" class="form-label fw-medium">Country Code + Phone Number</label>
                <div class="input-group">
                    <span class="input-group-text border-end-0">
                        <i class="bi bi-telephone text-muted"></i>
                    </span>
                    <input asp-for="Input.PhoneNumber" class="form-control border-start-0"
                           placeholder="Enter your phone number with country cod"/>
                </div>
                <span asp-validation-for="Input.PhoneNumber" class="text-danger small"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="Input.SpeakerTypeId" class="form-label fw-medium">Speaker type</label>
                <div class="input-group">
                    <span class="input-group-text border-end-0">
                        <i class="bi bi-person text-muted"></i>
                    </span>
                    <select asp-for="Input.SpeakerTypeId" class="form-select">
                        <option value="@Domain.Models.SpeakerTypeEnum.NewSpeaker" selected="@(Model.Input.SpeakerTypeId == Domain.Models.SpeakerTypeEnum.NewSpeaker)">@Domain.Models.SpeakerTypeEnum.NewSpeaker.GetDescription()</option>
                        <option value="@Domain.Models.SpeakerTypeEnum.ExperiencedSpeaker" selected="@(Model.Input.SpeakerTypeId == Domain.Models.SpeakerTypeEnum.ExperiencedSpeaker)">@Domain.Models.SpeakerTypeEnum.ExperiencedSpeaker.GetDescription()</option>
                    </select>
                </div>
                <span asp-validation-for="Input.SpeakerTypeId" class="text-danger small"></span>
            </div>            
        </div>
    </div>

    <!-- Profile Details -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="border-bottom pb-2 mb-3">
                <i class="bi bi-card-text me-2"></i>Profile Details
            </h5>
        </div>
        <div class="col-12 mb-3">
            <label asp-for="Input.Bio" class="form-label"></label>
            <textarea asp-for="Input.Bio" class="form-control" rows="4" 
                      placeholder="Tell others about yourself, your experience, and what you're passionate about..."></textarea>
            <span asp-validation-for="Input.Bio" class="text-danger"></span>
            <div class="form-text">Share your background, experience, and what makes you passionate about speaking.</div>
        </div>
        <div class="col-12 mb-3">
            <label asp-for="Input.Goals" class="form-label"></label>
            <textarea asp-for="Input.Goals" class="form-control" rows="3" 
                      placeholder="What are your speaking goals? What do you hope to achieve?"></textarea>
            <span asp-validation-for="Input.Goals" class="text-danger"></span>
            <div class="form-text">Describe your speaking goals and what you hope to achieve through mentorship.</div>
        </div>
    </div>

    <!-- Profile Photo -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="border-bottom pb-2 mb-3">
                <i class="bi bi-camera me-2"></i>Profile Photo
            </h5>
        </div>
        <div class="col-12">
            <div class="mb-3">
                @if (!string.IsNullOrEmpty(Model.ProfileUser?.HeadshotUrl))
                {
                    <img src="@Model.ProfileUser.HeadshotUrl" 
                         alt="Current headshot" 
                         class="object-fit-contain border shadow-sm image-thumbnail rounded " 
                         style="width: 9em; height: 9em; object-fit: cover;" 
                         id="currentHeadshot" />
                }
                else
                {
                    <div class="border shadow-sm rounded d-flex align-items-center justify-content-center" 
                         style="width: 9em; height: 9em; margin: 0 auto;" 
                         id="currentHeadshot">
                        <i class="bi bi-person-fill text-muted" style="font-size: 9rem;"></i>
                    </div>
                }
            </div>
            <div class="mb-3">
                <input asp-for="Input.HeadshotUrl" 
                       class="form-control form-control-sm" 
                       placeholder="https://example.com/your-photo.jpg" />
                <div class="form-text">Direct link to your professional headshot image</div>
            </div>
            @* <div id="headshotContainer"> *@
            @*     <partial name="_HeadshotUpload" model="Model"/> *@
            @* </div> *@
        </div>
    </div>

    <!-- URLs and Links -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="border-bottom pb-2 mb-3">
                <i class="bi bi-link-45deg me-2"></i>Professional Links
            </h5>
        </div>
        <div class="col-12 mb-3">
            <label asp-for="Input.SessionizeUrl" class="form-label"></label>
            <input asp-for="Input.SessionizeUrl" class="form-control" placeholder="https://sessionize.com/your-profile" />
            <span asp-validation-for="Input.SessionizeUrl" class="text-danger"></span>
            <div class="form-text">Link to your Sessionize speaker profile.</div>
        </div>
    </div>

    <!-- Expertise Areas -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="border-bottom pb-2 mb-3">
                <i class="bi bi-gear-fill me-2"></i>Areas of Expertise
            </h5>
            <div class="form-text mb-3">Select the technologies and topics you're knowledgeable about.</div>
        </div>
        <div class="row mb-4">
            @foreach (var expertise in Model.AvailableExpertise)
            {
                <div class="col-md-3 col-sm-6 mb-2">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" switch
                               name="Input.SelectedExpertiseIds" 
                               value="@expertise.Id"
                               id="expertise_@expertise.Id"
                               @(Model.Input.SelectedExpertiseIds?.Contains(expertise.Id) == true ? "checked" : "") />
                        <label class="form-check-label" for="expertise_@expertise.Id">
                            @expertise.Name
                        </label>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Social Media Links -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="border-bottom pb-2 mb-3">
                <i class="bi bi-share me-2"></i>Social Media Links
            </h5>
            <div class="form-text mb-3">Add your social media profiles and professional links.</div>
        </div>
        <div class="col-12" id="socialMediaContainer">
            @{
                var index = 0;
                var socialMediaSites = Model.SocialMediaSites.ToList();
            }

            @if (Model.ProfileUser?.UserSocialMediaSites != null)
            {
                foreach (var userSocialMediaSite in Model.ProfileUser.UserSocialMediaSites)
                {
                    var model = new UserSocialMediaSiteRow
                    {
                        UserSocialMediaSite = userSocialMediaSite,
                        SocialMediaSites = socialMediaSites,
                        ItemNumber = index
                    };
                    index++;
                    @await Html.PartialAsync("_UserSocialMediaSiteRow", model)
                }
            }
            <input type="hidden" name="socialMediaSitesCount" value="@index" />
        </div>
        <div id="replaceSocialMediaRow">
            <div id="addingRowSpinner" class="htmx-indicator">
                <div class="spinner-border spinner-border-sm me-2" role="status">
                    <span class="visually-hidden">Adding row...</span>
                </div>
                Adding row...
            </div>
            <button class="btn btn-primary float-end" type="button"
                    hx-get="/Profile/Edit?handler=AddSocialMediaRow"
                    hx-target="[name=socialMediaSitesCount], :nth-last-child(1 of .social-media-row)"
                    hx-include="[name='socialMediaSitesCount']"
                    hx-indicator="#addingRowSpinner"
                    hx-swap="afterend"
                    hx-on::after-request="document.querySelector('[name=socialMediaSitesCount]').value = document.querySelector(':nth-last-child(1 of .social-media-row)').dataset.id">
                <i class="bi bi-plus-square me-2"></i>Add
            </button>
        </div>
    </div>

    <!-- Submit Button -->
    <div class="d-flex justify-content-between align-items-center">
        <div id="loadingSpinner" class="htmx-indicator">
            <div class="spinner-border spinner-border-sm me-2" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            Updating profile...
        </div>
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-floppy me-2"></i>Update Profile
        </button>
    </div>
    @Html.AntiForgeryToken()
</form>