@model MoreSpeakers.Web.Models.ViewModels.SpeakerResultsViewModel

@if (!Model.Speakers.Any())
{
    @await Html.PartialAsync("_SpeakerResults_NoResults", new SpeakerResultsNoSpeakersFoundViewModel{SearchType = Model.SearchType})
}
else
{
    <div class="row">
        <div class="row row-cols-4 row-cols-md-3 row-cols-sm-2 g-2">
            @foreach (var speaker in Model.Speakers)
            {
                @await Html.PartialAsync("_SpeakerResults_Speaker", new SpeakerResultsSpeakerViewModel
                {
                    Speaker = speaker,
                    CurrentUser = Model.CurrentUser
                })
            }
        </div>
    </div>
    <!-- Pagination -->
    @if (Model.TotalPages > 1)
    {
        <nav aria-label="Speakers pagination" class="mt-4">
            <ul class="pagination justify-content-center">
                @if (Model.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link"
                           href="@GetPageUrl(Model.CurrentPage - 1)"
                           hx-get="@GetPageUrl(Model.CurrentPage - 1)"
                           hx-target="#speakers-container" hx-swap="morph">
                            <i class="bi bi-chevron-left"></i> Previous
                        </a>
                    </li>
                }

                @for (var pageNumber = 1; pageNumber <= Model.TotalPages; pageNumber++)
                {
                    <li class="page-item @(pageNumber == Model.CurrentPage ? "active" : "")">
                        <a class="page-link"
                           href="@GetPageUrl(pageNumber)"
                           hx-get="@GetPageUrl(pageNumber)"
                           hx-target="#speakers-container" hx-swap="morph">
                            @pageNumber
                        </a>
                    </li>
                }

                @if (Model.CurrentPage < Model.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link"
                           href="@GetPageUrl(Model.CurrentPage + 1)"
                           hx-get="@GetPageUrl(Model.CurrentPage + 1)"
                           hx-target="#speakers-container" hx-swap="morph">
                            Next <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                }
            </ul>
        </nav>
    }
}

@functions {

    private string GetPageUrl(int page)
    {
        var queryParams = new List<string> { $"CurrentPage={page}" };

        if (!string.IsNullOrEmpty(Model.SearchTerm))
            queryParams.Add($"SearchTerm={Uri.EscapeDataString(Model.SearchTerm)}");

        if (Model.SpeakerTypeFilter.HasValue)
            queryParams.Add($"SpeakerTypeFilter={Model.SpeakerTypeFilter}");

        if (Model.ExpertiseFilter.HasValue)
            queryParams.Add($"ExpertiseFilter={Model.ExpertiseFilter}");

        queryParams.Add($"SortBy={Model.SortBy}");

        return $"/Speakers/Index?{string.Join("&", queryParams)}";
    }
}
